generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model categories {
  id          String     @id
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  products    products[]
}

model inventory {
  id             String           @id
  productId      String
  warehouseId    String
  quantity       Int              @default(0)
  reservedQty    Int              @default(0)
  availableQty   Int              @default(0)
  lastStockIn    DateTime?
  lastStockOut   DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  products       products         @relation(fields: [productId], references: [id], onDelete: Cascade)
  warehouses     warehouses       @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  inventory_logs inventory_logs[]

  @@unique([productId, warehouseId])
  @@index([productId])
  @@index([warehouseId])
}

model inventory_logs {
  id             String    @id
  inventoryId    String
  userId         String
  action         String
  quantityBefore Int
  quantityAfter  Int
  difference     Int
  notes          String?
  createdAt      DateTime  @default(now())
  inventory      inventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)
  users          users     @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([inventoryId])
  @@index([userId])
}

model products {
  id                                String         @id
  sku                               String         @unique
  barcode                           String?        @unique
  name                              String
  description                       String?
  categoryId                        String?
  unit                              String         @default("piece")
  minStock                          Int            @default(10)
  maxStock                          Int            @default(1000)
  price                             Decimal        @default(0) @db.Decimal(10, 2)
  cost                              Decimal        @default(0) @db.Decimal(10, 2)
  imageUrl                          String?
  isActive                          Boolean        @default(true)
  createdById                       String
  updatedById                       String?
  createdAt                         DateTime       @default(now())
  updatedAt                         DateTime
  inventory                         inventory[]
  categories                        categories?    @relation(fields: [categoryId], references: [id])
  users_products_createdByIdTousers users          @relation("products_createdByIdTousers", fields: [createdById], references: [id])
  users_products_updatedByIdTousers users?         @relation("products_updatedByIdTousers", fields: [updatedById], references: [id])
  transactions                      transactions[]

  @@index([barcode])
  @@index([categoryId])
  @@index([sku])
}

model refresh_tokens {
  id        String   @id
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model transactions {
  id                                                  String            @id
  type                                                TransactionType
  status                                              TransactionStatus @default(PENDING)
  productId                                           String
  fromWarehouseId                                     String?
  toWarehouseId                                       String?
  quantity                                            Int
  notes                                               String?
  referenceNo                                         String?           @unique
  userId                                              String
  createdAt                                           DateTime          @default(now())
  updatedAt                                           DateTime
  warehouses_transactions_fromWarehouseIdTowarehouses warehouses?       @relation("transactions_fromWarehouseIdTowarehouses", fields: [fromWarehouseId], references: [id])
  products                                            products          @relation(fields: [productId], references: [id])
  warehouses_transactions_toWarehouseIdTowarehouses   warehouses?       @relation("transactions_toWarehouseIdTowarehouses", fields: [toWarehouseId], references: [id])
  users                                               users             @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([productId])
  @@index([status])
  @@index([type])
  @@index([userId])
}

model users {
  id                                   String           @id
  email                                String           @unique
  password                             String
  firstName                            String
  lastName                             String
  role                                 Role             @default(STAFF)
  isActive                             Boolean          @default(true)
  createdAt                            DateTime         @default(now())
  updatedAt                            DateTime
  inventory_logs                       inventory_logs[]
  products_products_createdByIdTousers products[]       @relation("products_createdByIdTousers")
  products_products_updatedByIdTousers products[]       @relation("products_updatedByIdTousers")
  refresh_tokens                       refresh_tokens[]
  transactions                         transactions[]
}

model warehouses {
  id                                                    String         @id
  code                                                  String         @unique
  name                                                  String
  location                                              String?
  description                                           String?
  isActive                                              Boolean        @default(true)
  createdAt                                             DateTime       @default(now())
  updatedAt                                             DateTime
  inventory                                             inventory[]
  transactions_transactions_fromWarehouseIdTowarehouses transactions[] @relation("transactions_fromWarehouseIdTowarehouses")
  transactions_transactions_toWarehouseIdTowarehouses   transactions[] @relation("transactions_toWarehouseIdTowarehouses")
}

enum Role {
  ADMIN
  MANAGER
  STAFF
}

enum TransactionStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum TransactionType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
}
